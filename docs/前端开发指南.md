# 前端开发指南

## 项目结构

```
frontend/
├── index.html          # 主页面
├── debug.html          # 调试页面
├── test.html           # 测试页面
├── simple-test.html    # 简单测试页面
├── css/
│   └── styles.css      # 样式文件
└── js/
    ├── config.js       # API配置
    ├── api.js          # API接口层
    └── app.js          # 应用主逻辑
```

## 快速启动

### 启动前端服务

```bash
cd frontend
python -m http.server 8080
```

或使用Node.js：
```bash
npx serve .
```

访问地址: http://localhost:8080

## 功能说明

### 主页面 (index.html)

完整的农业机器人控制界面，包含：

- **机器人状态监控**: 电量、速度、温度、坐标
- **传感器数据**: 土壤湿度/温度、光照、空气湿度
- **远程控制**: 方向控制(WASD/方向键)、作业控制
- **任务管理**: 任务列表、进度跟踪
- **作业统计**: 面积统计、完成进度
- **系统日志**: 实时操作记录

### 调试页面 (debug.html)

用于调试和测试：
- 检查JavaScript文件是否正确加载
- 测试API连接
- 检查DOM元素

### 简单测试页面 (simple-test.html)

基础测试：
- 测试基本的JavaScript执行
- 测试API连接

## 代码架构

### config.js - 配置文件

```javascript
const API_CONFIG = {
    BASE_URL: 'http://localhost:3000',
    ENDPOINTS: {
        HEALTH: '/api/health',
        ROBOT_STATUS: '/api/robot/status',
        ROBOT_CONTROL: '/api/robot/control',
        SENSORS: '/api/sensors',
        TASKS: '/api/tasks',
        STATISTICS: '/api/statistics'
    }
};
```

### api.js - API接口层

封装所有API调用：
- `API.checkHealth()` - 健康检查
- `API.getRobotStatus()` - 获取机器人状态
- `API.sendControlCommand(command)` - 发送控制指令
- `API.sendActionCommand(action)` - 发送作业指令
- `API.getSensors()` - 获取传感器数据
- `API.getTasks()` - 获取任务列表
- `API.getStatistics()` - 获取统计数据

### app.js - 应用主逻辑

核心功能：
- DOM初始化
- 事件监听器绑定
- 数据轮询服务
- UI更新逻辑

## 问题排查指南

### 当前状态
- 后端服务运行在: http://localhost:3000
- 前端服务运行在: http://localhost:8080

### 测试页面
1. **调试页面**: http://localhost:8080/debug.html
   - 检查JavaScript文件是否正确加载
   - 测试API连接
   - 检查DOM元素

2. **简单测试**: http://localhost:8080/simple-test.html
   - 测试基本的JavaScript执行
   - 测试API连接

3. **主页面**: http://localhost:8080/index.html
   - 完整的农业机器人控制界面

### 常见问题

#### 1. 页面没有反应

**原因**: 可能是JavaScript文件没有正确加载

**解决方法**:
1. 打开浏览器开发者工具 (F12)
2. 查看Console标签页，查看是否有错误
3. 查看Network标签页，检查JavaScript文件是否加载成功

#### 2. API连接失败

**原因**: 后端服务没有运行或CORS问题

**解决方法**:
1. 检查后端服务是否运行: `curl http://localhost:3000/api/health`
2. 查看浏览器控制台的错误信息
3. 确保使用HTTP协议访问页面（不是file://）

#### 3. 数据不更新

**原因**: 可能是定时器没有正确启动

**解决方法**:
1. 打开浏览器开发者工具
2. 查看Console标签页，检查是否有"系统启动成功"的日志
3. 查看Network标签页，检查是否有定期的API请求

### 控制台日志说明

正常启动应该看到以下日志:
```
开始加载JavaScript文件...
config.js 已加载, API_CONFIG: 已定义
api.js 已加载, API: 已定义
app.js 已加载
🤖 农业机器人控制系统启动中...
📡 后端地址: http://localhost:3000
✅ DOM初始化完成
✅ 事件监听器初始化完成
✅ 数据服务启动完成
✅ 前端启动完成
系统启动成功
```

### 快速测试

在浏览器控制台输入以下命令测试:

```javascript
// 测试API连接
fetch('http://localhost:3000/api/robot/status')
  .then(r => r.json())
  .then(d => console.log('机器人状态:', d))

// 测试机器人控制
API.sendControlCommand('forward')

// 查看应用状态
window.RobotApp
```

## 开发建议

### BEM命名规范

CSS使用BEM命名规范：
```css
.dashboard { }                    /* Block */
.dashboard__header { }            /* Element */
.dashboard__header--active { }    /* Modifier */
```

### 代码组织

- 保持模块化设计
- API调用统一通过api.js
- 配置集中在config.js
- 业务逻辑在app.js

### 性能优化

- 合理设置轮询间隔
  - 机器人状态: 2秒
  - 传感器数据: 3秒
  - 任务列表: 5秒
  - 统计数据: 10秒
- 避免不必要的DOM操作
- 使用防抖/节流处理频繁事件

## 浏览器兼容性

支持现代浏览器：
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

使用的API：
- Fetch API
- ES6+ JavaScript
- CSS Grid / Flexbox

## 调试技巧

### 1. 使用浏览器开发者工具

- **Console**: 查看日志和错误
- **Network**: 监控API请求
- **Elements**: 检查DOM结构
- **Application**: 查看存储和缓存

### 2. 启用详细日志

在config.js中添加调试模式：
```javascript
const DEBUG = true;
```

### 3. 网络请求监控

查看所有API请求：
```javascript
// 在控制台运行
performance.getEntriesByType('resource')
  .filter(r => r.name.includes('/api/'))
  .forEach(r => console.log(r.name, r.duration + 'ms'))
```

## 部署说明

### 开发环境
- 使用Python HTTP服务器
- API地址: http://localhost:3000

### 生产环境
1. 修改config.js中的API地址
2. 使用Nginx或其他Web服务器托管
3. 启用HTTPS
4. 配置CORS策略

---

**前端开发文档**
